# ESM 232 Assignment 3: Almond Yield & Profit

---
author: "Kelsey Warren and Taylor Cook"
date: "2025-04-15"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Load packages

```{r laod_packages}
library(tidyverse)
library(here)
library(purrr)
```

# 1. Develop a profit model for your almond yield

-   Use your imagination to think about what would make sense
-   Make sure you include parameters
-   You could assume a baseline profit and then adjust according to the anomaly

```{r load_data}
#load almond yield data
clim <- read.table(here("data/clim.txt"), header = TRUE, sep = "", strip.white = TRUE)

source(here("~/Bren MESM/ESM 232 ENV Modeling/ESM232_EnvModeling/R/almondyield.R"))
source(here("~/Bren MESM/ESM 232 ENV Modeling/ESM232_EnvModeling/R/almond_profit.R"))
source(here("~/Bren MESM/ESM 232 ENV Modeling/ESM232_EnvModeling/R/almond_wrapper.R"))

```

# 2. Apply the profit model to your almond yield model

-   There are many ways to combine the almond yield and profit functions; you can have the profit function "call"/use the almond yield function; or create a wrapper function that calls them in sequence (first the almond yield and then the profit function)

```{r wrapper}
# Wrapper function to calculate almond profit by first calculating the yield anomaly
# This wrapper function was already loaded above, but showing the code here for the example year 2000

almond_wrapper <- function(year = 2000, clim = clim) {
  
  # Step 1: Calculate the yield anomaly using the almondyield function
  yield_anomaly <- almondyield(year = 2000, clim = clim)
  
  # Step 2: Create a dataframe to store results (year studied, yield anomaly, and profit)
  profit_df <- data.frame(year = year, "yield anomaly" = yield_anomaly, profit = NA_real_)
  
  # Step 3: Calculate the profit using the almond_profit function and fill the profit_df data frame
  profit_df$profit <- almond_profit(yield_anomaly, clim, acres = 500, baseline_profit = 4000, 
                          price_per_ton = 6000, base_water_cost = 200)
  
  # Return the profit calculated
  return(profit_df)
}


# add results to a data frame in global environment
profit_df_2000 <- almond_profit_wrapper(2000, clim)

```

# 3. Perform a simple informal sensitivity analysis of almond yield profit using at least 2 parameters

```{r}


```

# 4. Create 2 graphs

```         
- one that shows yield anomaly for each year, accounting for uncertainty in the parameters
- one that show how yield anomaly in general varies with your parameters
```

```{r}

```

# 5. Write a short paragraph (in a Quatro document) to summarize you interpretation of your model results (e.g what do 'take away' from your model and sensitivity analysis)
